# RAG çŸ¥è­˜åº«å•ç­”ç³»çµ± - éƒ¨ç½²æŒ‡å—

## ğŸ“‹ ç³»çµ±æ¦‚è¿°

é€™æ˜¯ä¸€å€‹åŸºæ–¼ RAGï¼ˆRetrieval-Augmented Generationï¼‰æ¶æ§‹çš„æ™ºèƒ½å•ç­”ç³»çµ±ï¼Œå…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š

- **ğŸ“„ å‹•æ…‹çŸ¥è­˜åº«**ï¼šä¸Šå‚³æ–‡æª”è‡ªå‹•å»ºç«‹çŸ¥è­˜åº«
- **ğŸ¤– æ™ºèƒ½å›ç­”**ï¼šä½¿ç”¨æœ¬åœ° LLM æä¾›ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„å›ç­”
- **âš¡ å‘é‡æª¢ç´¢**ï¼šå¿«é€Ÿæª¢ç´¢ç›¸é—œæ–‡æª”
- **ğŸ¨ ç”¨æˆ¶å‹å¥½çš„ç•Œé¢**ï¼šç¾ä»£åŒ–çš„Web UI
- **ğŸš€ ç¨ç«‹å¯åŸ·è¡Œç¨‹å¼**ï¼šWindows EXE ç„¡éœ€Pythonç’°å¢ƒ

## ğŸ¯ åŠŸèƒ½è©³è§£

### 1. æ–‡æª”ä¸Šå‚³èˆ‡è™•ç†
- æ”¯æ´ `.txt`, `.md`, `.pdf`, `.doc`, `.docx` æ ¼å¼
- è‡ªå‹•åˆ†å‰²æ–‡æœ¬æˆåˆç†çš„ç‰‡æ®µï¼ˆchunkï¼‰
- ä½¿ç”¨ `sentence-transformers` ç”Ÿæˆå‘é‡è¡¨ç¤º
- å­˜å„²åˆ° `data/embeddings.json` å’Œ `data/docs/` ç›®éŒ„

### 2. RAG å•ç­”æµç¨‹
```
ç”¨æˆ¶å•é¡Œ
  â†“
å‘é‡åŒ–å•é¡Œ
  â†“
æª¢ç´¢ç›¸ä¼¼æ–‡æª”ç‰‡æ®µ (Top-3)
  â†“
çµ„åˆä¸Šä¸‹æ–‡ + å•é¡Œ
  â†“
æœ¬åœ° LLM ç”Ÿæˆå›ç­”
  â†“
è¿”å›çµæœ + ä¾†æºæ–‡æª” + è€—æ™‚çµ±è¨ˆ
```

### 3. æ™ºèƒ½å°æ¯”
ç³»çµ±æœƒåŒæ™‚ç”Ÿæˆï¼š
- **RAG å›ç­”**ï¼šåŸºæ–¼çŸ¥è­˜åº«çš„ä¸Šä¸‹æ–‡æ„ŸçŸ¥å›ç­”
- **åŸºç¤å›ç­”**ï¼šä¸ä½¿ç”¨çŸ¥è­˜åº«çš„å›ç­”ï¼ˆç”¨æ–¼å°æ¯”ï¼‰

é€™æ¨£å¯ä»¥ç›´è§€çœ‹åˆ°çŸ¥è­˜åº«å°å›ç­”è³ªé‡çš„æå‡ã€‚

## ğŸš€ å¿«é€Ÿé–‹å§‹

### æ–¹æ¡ˆ Aï¼šç›´æ¥é‹è¡Œ Windows EXEï¼ˆæ¨è–¦ï¼‰

1. **ä¸‹è¼‰ EXE**
   - å¾ GitHub Releases ä¸‹è¼‰æœ€æ–°çš„ `rag_qa_app-windows-exe.zip`
   - è§£å£“åˆ°ä»»æ„ç›®éŒ„

2. **æº–å‚™ LLM æ¨¡å‹**ï¼ˆå¯é¸ï¼Œä½†æ¨è–¦ï¼‰
   - ä¸‹è¼‰ GGML é‡åŒ–çš„ Llama 7B æ¨¡å‹ï¼Œä¾‹å¦‚ï¼š
     - https://huggingface.co/TheBloke/Mistral-7B-Instruct-v0.1-GGUF
     - æˆ–å…¶ä»– GGML æ ¼å¼çš„æ¨¡å‹
   - æ”¾åˆ° `models/model.gguf` ç›®éŒ„
   - æˆ–è¨­ç½®ç’°å¢ƒè®Šé‡ `MODEL_PATH=C:\path\to\your\model.gguf`

3. **é‹è¡Œ**
   ```
   rag_qa_app.exe
   ```
   - æœå‹™å™¨æœƒåœ¨ `http://127.0.0.1:8000` å•Ÿå‹•
   - è‡ªå‹•æ‰“é–‹ç€è¦½å™¨ï¼ˆæˆ–æ‰‹å‹•è¨ªå•ï¼‰

4. **ä½¿ç”¨**
   - **ä¸Šå‚³æ–‡æª”**ï¼šå·¦å´"çŸ¥è­˜åº«ç®¡ç†"é¢æ¿é¸æ“‡æ–‡ä»¶ä¸Šå‚³
   - **æå•**ï¼šå³å´è¼¸å…¥å•é¡Œï¼Œé»æ“Š"æå•"

### æ–¹æ¡ˆ Bï¼šä½¿ç”¨ Python é–‹ç™¼ç’°å¢ƒ

1. **å…‹éš†ä»£ç¢¼**
   ```bash
   git clone https://github.com/yantinglin1991/rag-qa-app.git
   cd rag-qa-app
   ```

2. **å‰µå»ºè™›æ“¬ç’°å¢ƒ**
   ```bash
   python -m venv venv
   venv\Scripts\activate
   ```

3. **å®‰è£ä¾è³´**
   ```bash
   pip install -r requirements.txt
   ```

4. **æº–å‚™ LLM æ¨¡å‹**ï¼ˆåŒæ–¹æ¡ˆ A çš„ç¬¬ 2 æ­¥ï¼‰

5. **é‹è¡Œ**
   ```bash
   python launcher.py
   ```

## ğŸ“¦ æ–‡ä»¶çµæ§‹

```
rag-qa-app/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py                 # FastAPI æ‡‰ç”¨ä¸»é«”
â”‚   â”œâ”€â”€ model_loader.py         # LLM åŠ è¼‰å’Œæ¨ç†
â”‚   â”œâ”€â”€ retriever.py            # æ–‡æª”æª¢ç´¢é‚è¼¯
â”‚   â””â”€â”€ document_processor.py   # æ–‡æª”ä¸Šå‚³å’Œè™•ç†
â”œâ”€â”€ static/
â”‚   â”œâ”€â”€ index.html              # å‰ç«¯ UI
â”‚   â””â”€â”€ app.js                  # å‰ç«¯é‚è¼¯
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ docs/                   # ä¸Šå‚³çš„æ–‡æª”
â”‚   â”œâ”€â”€ embeddings.json         # å‘é‡ç´¢å¼•
â”‚   â””â”€â”€ index.json              # æ–‡æª”å…ƒæ•¸æ“š
â”œâ”€â”€ launcher.py                 # æ‡‰ç”¨å…¥å£
â”œâ”€â”€ requirements.txt            # Python ä¾è³´
â””â”€â”€ README.md
```

## ğŸ”§ ç’°å¢ƒè®Šé‡é…ç½®

### å¸¸ç”¨é…ç½®

```bash
# LLM æ¨¡å‹è·¯å¾‘ï¼ˆå¦‚æœä¸è¨­ç½®ï¼Œæœƒå˜—è©¦ ./models/model.ggufï¼‰
MODEL_PATH=C:\path\to\model.gguf

# LLM ç·šç¨‹æ•¸ï¼ˆé»˜èª 4ï¼‰
LLAMA_THREADS=8

# æ–‡æª”ç´¢å¼•è·¯å¾‘
INDEX_PATH=./data/index.json
```

### è¨­ç½®æ–¹æ³•

**Windows å‘½ä»¤è¡Œï¼š**
```bash
set MODEL_PATH=C:\path\to\model.gguf
rag_qa_app.exe
```

**PowerShellï¼š**
```powershell
$env:MODEL_PATH='C:\path\to\model.gguf'
.\rag_qa_app.exe
```

**å‰µå»º .env æ–‡ä»¶ï¼ˆè‡ªå‹•åŠ è¼‰ï¼‰ï¼š**
```
MODEL_PATH=./models/model.gguf
LLAMA_THREADS=8
```

## ğŸ¤– LLM æ¨¡å‹æ¨è–¦

### æ¨è–¦æ¨¡å‹

| æ¨¡å‹ | å¤§å° | æ€§èƒ½ | ä¸‹è¼‰æº |
|------|------|------|--------|
| Mistral-7B-Instruct | 4.2GB | å„ªç§€ | [TheBloke/Mistral-7B-Instruct-v0.1-GGUF](https://huggingface.co/TheBloke/Mistral-7B-Instruct-v0.1-GGUF) |
| Llama-2-7B-Chat | 3.8GB | è‰¯å¥½ | [TheBloke/Llama-2-7B-Chat-GGUF](https://huggingface.co/TheBloke/Llama-2-7B-Chat-GGUF) |
| Orca-2-7B | 4.0GB | è‰¯å¥½ | [TheBloke/Orca-2-7B-GGUF](https://huggingface.co/TheBloke/Orca-2-7B-GGUF) |
| Neural-Chat-7B | 4.1GB | å„ªç§€ | [TheBloke/neural-chat-7B-v3-2-GGUF](https://huggingface.co/TheBloke/neural-chat-7B-v3-2-GGUF) |

### ä¸‹è¼‰æ­¥é©Ÿ

1. è¨ªå• HuggingFace æ¨¡å‹é é¢
2. ä¸‹è¼‰ `*.Q5_K_M.gguf` æˆ– `*.Q4_K_M.gguf` ç‰ˆæœ¬ï¼ˆå¹³è¡¡è³ªé‡å’Œé€Ÿåº¦ï¼‰
3. æ”¾åˆ° `models/` ç›®éŒ„æˆ–è¨­ç½® `MODEL_PATH` ç’°å¢ƒè®Šé‡

**ä¾‹å­ï¼š**
```bash
# å‰µå»º models ç›®éŒ„
mkdir models

# ä¸‹è¼‰æ¨¡å‹ï¼ˆä»¥ Mistral ç‚ºä¾‹ï¼‰
# è¨ªå• https://huggingface.co/TheBloke/Mistral-7B-Instruct-v0.1-GGUF
# ä¸‹è¼‰ mistral-7b-instruct-v0.1.Q5_K_M.gguf
# æ”¾åˆ° models/model.gguf
```

## ğŸ” API æ–‡æª”

### POST /qa - æå•
**è«‹æ±‚ï¼š**
```json
{
  "question": "Python å¦‚ä½•è®€å– CSV æ–‡ä»¶ï¼Ÿ",
  "top_k": 3
}
```

**éŸ¿æ‡‰ï¼š**
```json
{
  "question": "Python å¦‚ä½•è®€å– CSV æ–‡ä»¶ï¼Ÿ",
  "rag_answer": "æ ¹æ“šä¸Šå‚³çš„æ–‡æª”ï¼Œä½ å¯ä»¥ä½¿ç”¨...",
  "baseline_answer": "Python æœ‰å¤šç¨®æ–¹å¼è®€å– CSV...",
  "sources": [
    {
      "id": "document.txt_chunk_0",
      "filename": "document.txt",
      "score": 0.8524,
      "text": "Python CSV è®€å–ç¤ºä¾‹..."
    }
  ],
  "timings": {
    "retrieval_ms": 12.45,
    "llm_rag_ms": 1234.56,
    "llm_baseline_ms": 1200.34
  }
}
```

### POST /upload-doc - ä¸Šå‚³æ–‡æª”
**å¤šéƒ¨åˆ†è¡¨å–®æ•¸æ“šï¼š**
```
Content-Type: multipart/form-data
file: <binary file content>
```

**éŸ¿æ‡‰ï¼š**
```json
{
  "success": true,
  "message": "Document processed successfully",
  "filename": "document.txt",
  "chunks_count": 5,
  "embeddings_count": 5
}
```

### GET /documents - åˆ—è¡¨æ–‡æª”
**éŸ¿æ‡‰ï¼š**
```json
{
  "success": true,
  "documents": [
    {
      "filename": "document.txt",
      "chunks": 5,
      "content_length": 2500,
      "timestamp": 1705949000.123
    }
  ],
  "count": 1
}
```

### DELETE /documents/{filename} - åˆªé™¤æ–‡æª”
**åƒæ•¸ï¼š**
- `filename`: è¦åˆªé™¤çš„æ–‡æª”å

**éŸ¿æ‡‰ï¼š**
```json
{
  "success": true,
  "message": "Document 'document.txt' deleted successfully"
}
```

## ğŸ› æ•…éšœæ’é™¤

### å•é¡Œ 1ï¼šEXE ç„¡æ³•å•Ÿå‹•
**ç—‡ç‹€ï¼š** é‹è¡Œ EXE å¾Œæ²’æœ‰åæ‡‰æˆ–ç«‹å³é—œé–‰

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. ç¢ºä¿ Windows å·²æ›´æ–°ï¼ˆWindows 10/11ï¼‰
2. æª¢æŸ¥æ˜¯å¦ç¼ºå°‘ Visual C++ Runtimeï¼š
   - ä¸‹è¼‰ä¸¦å®‰è£ [Visual C++ Redistributable](https://support.microsoft.com/en-us/help/2977003)
3. æŸ¥çœ‹ç³»çµ±æ—¥èªŒäº†è§£è©³ç´°éŒ¯èª¤ä¿¡æ¯

### å•é¡Œ 2ï¼šæ¨¡å‹åŠ è¼‰å¤±æ•—
**ç—‡ç‹€ï¼š** æå•è¿”å› "Dummy answer (no local LLM available)"

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. é©—è­‰æ¨¡å‹æ–‡ä»¶å­˜åœ¨ï¼š
   ```bash
   dir models\
   dir %MODEL_PATH%  # å¦‚æœè¨­ç½®äº†ç’°å¢ƒè®Šæ•¸
   ```
2. ç¢ºèªæ¨¡å‹æ ¼å¼æ˜¯ GGMLï¼ˆ`.gguf` å¾Œç¶´ï¼‰
3. æª¢æŸ¥æ¨¡å‹æ–‡ä»¶ä¸æå£ï¼ˆå¤§å°æ‡‰ >1GBï¼‰
4. ç¢ºä¿ç¡¬ç›¤ç©ºé–“å……è¶³ï¼ˆè‡³å°‘ 10GB å¯ç”¨ï¼‰

### å•é¡Œ 3ï¼šæœå‹™å™¨ç„¡æ³•å•Ÿå‹•
**ç—‡ç‹€ï¼š** ç„¡æ³•é€£æ¥åˆ° 127.0.0.1:8000

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. æª¢æŸ¥ç«¯å£æ˜¯å¦è¢«å ç”¨ï¼š
   ```bash
   netstat -ano | findstr :8000
   ```
2. ä¿®æ”¹ç«¯å£ï¼ˆç·¨è¼¯ launcher.pyï¼‰ï¼š
   ```python
   uvicorn.run(app, host="127.0.0.1", port=8001)  # æ”¹ç‚º 8001
   ```
3. å˜—è©¦å…è¨±é˜²ç«ç‰†è¨ªå•

### å•é¡Œ 4ï¼šæ–‡æª”ä¸Šå‚³å¤±æ•—
**ç—‡ç‹€ï¼š** "Upload failed" éŒ¯èª¤

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. æª¢æŸ¥æ–‡ä»¶å¤§å°ï¼ˆæ¨è–¦ <50MBï¼‰
2. ç¢ºä¿æ–‡ä»¶ååªå«è‹±æ–‡ã€æ•¸å­—ã€ä¸‹åŠƒç·šå’Œé»
3. é©—è­‰ `data/docs/` ç›®éŒ„å­˜åœ¨ä¸¦æœ‰å¯«å…¥æ¬Šé™
4. æŸ¥çœ‹ç€è¦½å™¨æ§åˆ¶å°ï¼ˆF12ï¼‰ç²å–è©³ç´°éŒ¯èª¤

### å•é¡Œ 5ï¼šæå•éŸ¿æ‡‰ç·©æ…¢
**ç—‡ç‹€ï¼š** ç­‰å¾…å›ç­”è¶…é 30 ç§’

**è§£æ±ºæ–¹æ¡ˆï¼š**
1. æª¢æŸ¥ CPU ä½¿ç”¨ç‡ï¼ˆLLM æ¨ç†æ˜¯ CPU å¯†é›†æ“ä½œï¼‰
2. å¢åŠ  LLAMA_THREADS ç’°å¢ƒè®Šé‡ï¼š
   ```bash
   set LLAMA_THREADS=16
   ```
3. ä½¿ç”¨æ›´å°çš„æ¨¡å‹ï¼ˆQ4_K_M ä»£æ›¿ Q5_K_Mï¼‰
4. æ¸›å°‘ `top_k` æª¢ç´¢æ–‡æª”æ•¸é‡

## ğŸ“ˆ æ€§èƒ½å„ªåŒ–

### 1. æ¨¡å‹é‡åŒ–ç­‰ç´š
- **Q2_K** (æœ€å¿«ï¼Œè³ªé‡æœ€ä½) - 2GB
- **Q4_K_M** (æ¨è–¦) - 4-5GB
- **Q5_K_M** (è¼ƒå¥½è³ªé‡) - 5-6GB
- **Q8_0** (é«˜è³ªé‡ï¼Œæœ€æ…¢) - 7GB+

### 2. ç·šç¨‹é…ç½®
```bash
# æŸ¥çœ‹ CPU æ ¸å¿ƒæ•¸
echo %NUMBER_OF_PROCESSORS%

# è¨­ç½®ç‚ºæ ¸å¿ƒæ•¸çš„ 0.5-1x
set LLAMA_THREADS=8
```

### 3. æª¢ç´¢å„ªåŒ–
- æ¸›å°‘ `top_k`ï¼ˆé»˜èª 3ï¼Œå¯æ”¹ç‚º 1-2ï¼‰
- å®šæœŸæ¸…ç†ä¸éœ€è¦çš„æ–‡æª”
- ä½¿ç”¨ç›¸é—œæ€§é«˜çš„æ–‡æª”

## ğŸ” å®‰å…¨è€ƒæ…®

1. **æœ¬åœ°é‹è¡Œ**ï¼šç³»çµ±åœ¨æœ¬åœ°é‹è¡Œï¼Œä¸ä¸Šå‚³ä»»ä½•æ•¸æ“šåˆ°é›²ç«¯
2. **æ–‡ä»¶é©—è­‰**ï¼šä¸Šå‚³æ–‡ä»¶åç¶“éé©—è­‰ï¼Œé˜²æ­¢ç›®éŒ„éæ­·æ”»æ“Š
3. **æ¨¡å‹éš±ç§**ï¼šLLM æ¨¡å‹å’Œæ–‡æª”å®Œå…¨ä¿ç•™åœ¨æœ¬åœ°
4. **é˜²ç«ç‰†**ï¼šé»˜èªåªç›£è½ localhostï¼ˆ127.0.0.1ï¼‰ï¼Œå¤–éƒ¨ç„¡æ³•è¨ªå•

## ğŸ“ å¸¸è¦‹å•é¡Œ (FAQ)

**Q: ç³»çµ±æ”¯æŒå¤šå°‘æ–‡æª”ï¼Ÿ**  
A: ç†è«–ä¸Šç„¡é™åˆ¶ï¼Œä½†è€ƒæ…®åˆ°æª¢ç´¢é€Ÿåº¦ï¼Œå»ºè­°ä¸è¶…é 100 å€‹æ–‡æª”æˆ– 1GB æ•¸æ“šé‡ã€‚

**Q: å¯ä»¥åœ¨ç¶²çµ¡ä¸­å…±äº«ä½¿ç”¨å—ï¼Ÿ**  
A: å¯ä»¥ï¼Œä¿®æ”¹ main.py ä¸­çš„ hostï¼š
```python
uvicorn.run(app, host="0.0.0.0", port=8000)  # å…è¨±å¤–éƒ¨è¨ªå•
```

**Q: ç‚ºä»€éº¼å›ç­”è³ªé‡ä¸å¥½ï¼Ÿ**  
A: æª¢æŸ¥ï¼š1) æ˜¯å¦ä¸Šå‚³äº†ç›¸é—œæ–‡æª” 2) æ–‡æª”è³ªé‡ 3) ä½¿ç”¨çš„ LLM æ¨¡å‹ 4) å•é¡Œè¡¨è¿°æ¸…æ™°åº¦

**Q: æ”¯æŒå“ªäº›èªè¨€ï¼Ÿ**  
A: å–æ±ºæ–¼ LLM æ¨¡å‹ã€‚æ¨è–¦æ¨¡å‹æ”¯æŒä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ç­‰å¤šèªè¨€ã€‚

**Q: å¯ä»¥è‡ªå®šç¾©æ¨¡å‹æç¤ºè©å—ï¼Ÿ**  
A: å¯ä»¥ï¼Œç·¨è¼¯ `app/model_loader.py` ä¸­çš„ `answer()` æ–¹æ³•ã€‚

## ğŸ”„ æ›´æ–°æ—¥èªŒ

### v1.0.0 (2025-01-23)
- âœ… å®Œæ•´çš„RAGç³»çµ±å¯¦ç¾
- âœ… æ–‡æª”å‹•æ…‹ä¸Šå‚³åŠŸèƒ½
- âœ… å‘é‡æª¢ç´¢å’Œç›¸ä¼¼åº¦æ’åº
- âœ… æœ¬åœ°LLMé›†æˆ
- âœ… ç¾ä»£åŒ–Web UI
- âœ… Windows EXEæ‰“åŒ…
- âœ… GitHub Actionsè‡ªå‹•æ§‹å»º

## ğŸ“ æŠ€è¡“æ”¯æŒ

- ğŸ“§ æäº¤ Issueï¼šhttps://github.com/yantinglin1991/rag-qa-app/issues
- ğŸ’¬ è®¨è®ºï¼šhttps://github.com/yantinglin1991/rag-qa-app/discussions
- ğŸ“š æ–‡æª”ï¼šè¦‹ README.md å’Œ DEPLOYMENT_GUIDE.md

## ğŸ“„ è¨±å¯è­‰

MIT License - è©³è¦‹ LICENSE æ–‡ä»¶

---

**æœ€å¾Œæ›´æ–°ï¼š** 2025-01-23  
**ç‰ˆæœ¬ï¼š** 1.0.0
